// Service catalog with all available services
export const SERVICE_CATALOG = [
  {
    category: "Poster Design",
    services: [
      {
        id: "tournament-poster",
        name: "Tournament Poster",
        price: 9000, // €90.00
        description: "Professional tournament poster design",
        category: "Poster Design",
      },
      {
        id: "team-poster",
        name: "Team Poster",
        price: 7000, // €70.00
        description: "Team-focused poster design",
        category: "Poster Design",
      },
      {
        id: "seminar-poster",
        name: "Seminar Poster",
        price: 8000, // €80.00
        description: "Seminar and workshop poster design",
        category: "Poster Design",
      },
      {
        id: "athlete-highlight-poster",
        name: "Athlete Highlight Poster",
        price: 7000, // €70.00
        description: "Individual athlete highlight poster",
        category: "Poster Design",
      },
      {
        id: "training-camp-poster",
        name: "Training Camp Poster",
        price: 8000, // €80.00
        description: "Training camp and event poster design",
        category: "Poster Design",
      },
      {
        id: "custom-poster-design",
        name: "Custom Poster Design",
        price: 4500, // €45.00
        description: "Fully customized poster design",
        category: "Poster Design",
      },
    ],
  },
  {
    category: "Banner Design",
    services: [
      {
        id: "event-banner",
        name: "Event Banner",
        price: 13000, // €130.00
        description: "Large format event banner design",
        category: "Banner Design",
      },
      {
        id: "dojo-banner",
        name: "Dojo Banner",
        price: 12000, // €120.00
        description: "Dojo branding banner design",
        category: "Banner Design",
      },
      {
        id: "competition-banner",
        name: "Competition Banner",
        price: 12000, // €120.00
        description: "Competition and tournament banner",
        category: "Banner Design",
      },
      {
        id: "roll-up-banner",
        name: "Roll-Up Banner",
        price: 11000, // €110.00
        description: "Professional roll-up banner design",
        category: "Banner Design",
      },
      {
        id: "social-media-banner",
        name: "Social Media Banner (FB/Twitter/YouTube)",
        price: 6000, // €60.00
        description: "Social media platform banner design",
        category: "Banner Design",
      },
    ],
  },
  {
    category: "Logo Design",
    services: [
      {
        id: "karate-dojo-logo",
        name: "Karate Dojo Logo",
        price: 14000, // €140.00
        description: "Professional dojo logo design",
        category: "Logo Design",
      },
      {
        id: "tournament-logo",
        name: "Tournament Logo",
        price: 14000, // €140.00
        description: "Tournament and event logo design",
        category: "Logo Design",
      },
      {
        id: "personal-brand-logo",
        name: "Personal Brand Logo",
        price: 12000, // €120.00
        description: "Personal branding logo design",
        category: "Logo Design",
      },
      {
        id: "mascot-logo",
        name: "Mascot Logo for Teams",
        price: 16000, // €160.00
        description: "Team mascot logo design",
        category: "Logo Design",
      },
      {
        id: "minimal-modern-logo",
        name: "Minimal/Modern Logo (general use)",
        price: 11000, // €110.00
        description: "Clean and modern logo design",
        category: "Logo Design",
      },
    ],
  },
  {
    category: "Social Media Graphics",
    services: [
      {
        id: "instagram-post-pack",
        name: "Instagram Post Pack (5 posts)",
        price: 7000, // €70.00
        description: "Pack of 5 Instagram post designs",
        category: "Social Media Graphics",
      },
      {
        id: "instagram-story-pack",
        name: "Instagram Story Pack (5 stories)",
        price: 6000, // €60.00
        description: "Pack of 5 Instagram story designs",
        category: "Social Media Graphics",
      },
      {
        id: "facebook-instagram-ad",
        name: "Facebook/Instagram Ad Design",
        price: 4000, // €40.00
        description: "Professional ad design for social media",
        category: "Social Media Graphics",
      },
      {
        id: "athlete-dojo-social-pack",
        name: "Athlete/Dojo Social Pack (10 posts + 5 stories)",
        price: 12000, // €120.00
        description: "Comprehensive social media pack",
        category: "Social Media Graphics",
      },
    ],
  },
  {
    category: "Merch & Apparel Design",
    services: [
      {
        id: "t-shirt-design",
        name: "T-Shirt Design",
        price: 6000, // €60.00
        description: "Custom t-shirt design",
        category: "Merch & Apparel Design",
      },
      {
        id: "hoodie-design",
        name: "Hoodie Design",
        price: 7000, // €70.00
        description: "Custom hoodie design",
        category: "Merch & Apparel Design",
      },
      {
        id: "gi-patch-dojo-patch",
        name: "Gi Patch / Dojo Patch",
        price: 5000, // €50.00
        description: "Custom patch design for gi or dojo",
        category: "Merch & Apparel Design",
      },
      {
        id: "merchandise-pack",
        name: "Merchandise Pack (T-shirt + Hoodie + Patch)",
        price: 15000, // €150.00
        description: "Complete merchandise design pack",
        category: "Merch & Apparel Design",
      },
    ],
  },
  {
    category: "Event & Dojo Materials",
    services: [
      {
        id: "certificate-design",
        name: "Certificate Design (Belt / Participation / Achievement)",
        price: 5000, // €50.00
        description: "Professional certificate design",
        category: "Event & Dojo Materials",
      },
      {
        id: "medal-ribbon-design",
        name: "Medal/Ribbon Design",
        price: 6000, // €60.00
        description: "Medal and ribbon design",
        category: "Event & Dojo Materials",
      },
      {
        id: "ticket-pass-design",
        name: "Ticket/Pass Design",
        price: 4000, // €40.00
        description: "Event ticket and pass design",
        category: "Event & Dojo Materials",
      },
      {
        id: "business-card-design",
        name: "Business Card Design",
        price: 4000, // €40.00
        description: "Professional business card design",
        category: "Event & Dojo Materials",
      },
      {
        id: "flyer-leaflet-single",
        name: "Flyer/Leaflet (single side)",
        price: 5000, // €50.00
        description: "Single-sided flyer design",
        category: "Event & Dojo Materials",
      },
      {
        id: "flyer-leaflet-double",
        name: "Flyer/Leaflet (double side)",
        price: 7000, // €70.00
        description: "Double-sided flyer design",
        category: "Event & Dojo Materials",
      },
    ],
  },
  {
    category: "Digital & Video Graphics",
    services: [
      {
        id: "motion-poster-animated-ad",
        name: "Motion Poster / Animated Social Ad",
        price: 9000, // €90.00
        description: "Animated poster and social media ads",
        category: "Digital & Video Graphics",
      },
      {
        id: "video-intro-outro",
        name: "Video Intro/Outro",
        price: 12000, // €120.00
        description: "Professional video intro and outro design",
        category: "Digital & Video Graphics",
      },
      {
        id: "tournament-promo-video",
        name: "Tournament Promo Video (short edit)",
        price: 15000, // €150.00
        description: "Short tournament promotional video",
        category: "Digital & Video Graphics",
      },
    ],
  },
  {
    category: "Package Deals",
    services: [
      {
        id: "event-branding-package",
        name: "Event Branding Package",
        price: 22000, // €220.00
        description: "Complete event branding solution",
        category: "Package Deals",
      },
      {
        id: "dojo-starter-pack",
        name: "Dojo Starter Pack",
        price: 30000, // €300.00
        description: "Essential dojo branding package",
        category: "Package Deals",
      },
      {
        id: "athlete-highlight-pack",
        name: "Athlete Highlight Pack",
        price: 15000, // €150.00
        description: "Complete athlete branding package",
        category: "Package Deals",
      },
      {
        id: "tournament-promo-pack",
        name: "Tournament Promo Pack",
        price: 35000, // €350.00
        description: "Comprehensive tournament promotion package",
        category: "Package Deals",
      },
      {
        id: "social-media-growth-pack",
        name: "Social Media Growth Pack",
        price: 20000, // €200.00
        description: "Complete social media growth solution",
        category: "Package Deals",
      },
      {
        id: "complete-dojo-identity-pack",
        name: "Complete Dojo Identity Pack",
        price: 50000, // €500.00
        description: "Full dojo identity and branding package",
        category: "Package Deals",
      },
    ],
  },
];

// Utility functions
export const getServiceById = (id) => {
  for (const category of SERVICE_CATALOG) {
    const service = category.services.find((s) => s.id === id);
    if (service) return service;
  }
  return null;
};

// Validate service data
export const validateService = (service) => {
  return (
    service &&
    typeof service === "object" &&
    typeof service.id === "string" &&
    typeof service.name === "string" &&
    typeof service.price === "number" &&
    service.price > 0 &&
    typeof service.description === "string" &&
    typeof service.category === "string"
  );
};

// Format price from cents to euros
export const formatPrice = (priceInCents) => {
  return new Intl.NumberFormat("de-DE", {
    style: "currency",
    currency: "EUR",
    minimumFractionDigits: 2,
  }).format(priceInCents / 100);
};

// Calculate cart total
export const calculateCartTotal = (items) => {
  if (!Array.isArray(items)) return 0;
  return items.reduce((total, item) => {
    return total + item.service.price * item.quantity;
  }, 0);
};

// Calculate total item count
export const calculateItemCount = (items) => {
  return items.reduce((count, item) => count + item.quantity, 0);
};

// Add item to cart
export const addItemToCart = (cart, service, quantity = 1) => {
  if (!validateService(service)) {
    throw new Error("Invalid service data");
  }

  const existingItem = cart.items.find((item) => item.serviceId === service.id);

  if (existingItem) {
    // Update quantity of existing item
    const newQuantity = existingItem.quantity + quantity;
    if (newQuantity > 100) {
      throw new Error("Maximum quantity per item is 100");
    }

    return {
      ...cart,
      items: cart.items.map((item) =>
        item.id === existingItem.id ? { ...item, quantity: newQuantity } : item
      ),
    };
  } else {
    // Add new item
    const newItem = createCartItem(service, quantity);
    return {
      ...cart,
      items: [...cart.items, newItem],
    };
  }
};

// Update item quantity
export const updateItemQuantity = (cart, itemId, quantity) => {
  if (quantity < 1 || quantity > 100) {
    throw new Error("Quantity must be between 1 and 100");
  }

  return {
    ...cart,
    items: cart.items.map((item) =>
      item.id === itemId ? { ...item, quantity } : item
    ),
  };
};

// Remove item from cart
export const removeItemFromCart = (cart, itemId) => {
  return {
    ...cart,
    items: cart.items.filter((item) => item.id !== itemId),
  };
};

// Update item design preferences
export const updateItemPreferences = (cart, itemId, preferences) => {
  return {
    ...cart,
    items: cart.items.map((item) =>
      item.id === itemId
        ? {
            ...item,
            designPreferences: {
              ...item.designPreferences,
              ...preferences,
            },
          }
        : item
    ),
  };
};

// Update item uploaded files
export const updateItemFiles = (cart, itemId, files) => {
  return {
    ...cart,
    items: cart.items.map((item) =>
      item.id === itemId ? { ...item, uploadedFiles: files } : item
    ),
  };
};

// Get current cart state
export const getCartState = () => {
  const cart = loadCart();
  if (!cart) {
    return {
      items: [],
      total: 0,
      itemCount: 0,
      isEmpty: true,
    };
  }

  const total = calculateCartTotal(cart.items);
  const itemCount = calculateItemCount(cart.items);

  return {
    items: cart.items,
    total,
    itemCount,
    isEmpty: cart.items.length === 0,
  };
};

// Create cart item
const createCartItem = (service, quantity) => {
  return {
    id: `${service.id}-${Date.now()}-${Math.random()
      .toString(36)
      .substr(2, 9)}`,
    serviceId: service.id,
    service,
    quantity,
    designPreferences: {},
    uploadedFiles: [],
    addedAt: new Date().toISOString(),
  };
};

// Load cart from localStorage
export const loadCart = () => {
  if (typeof window === "undefined") return null;
  try {
    const cartData = localStorage.getItem("karate-designs-cart");
    return cartData ? JSON.parse(cartData) : null;
  } catch (error) {
    console.error("Error loading cart:", error);
    return null;
  }
};

// Save cart to localStorage
export const saveCart = (cart) => {
  if (typeof window === "undefined") return;
  try {
    localStorage.setItem("karate-designs-cart", JSON.stringify(cart));
  } catch (error) {
    console.error("Error saving cart:", error);
  }
};

// Clear cart from localStorage
export const clearCart = () => {
  if (typeof window === "undefined") return;
  try {
    localStorage.removeItem("karate-designs-cart");
  } catch (error) {
    console.error("Error clearing cart:", error);
  }
};

// Validate cart data
export const validateCart = (cart) => {
  if (!cart || !Array.isArray(cart.items)) return false;

  return cart.items.every(
    (item) =>
      item &&
      typeof item === "object" &&
      typeof item.id === "string" &&
      typeof item.serviceId === "string" &&
      item.service &&
      validateService(item.service) &&
      typeof item.quantity === "number" &&
      item.quantity > 0 &&
      item.quantity <= 100
  );
};
